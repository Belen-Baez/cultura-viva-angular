<div class="main-container">

  <!-- Mensaje modal para info o login -->
  <div *ngIf="mensajeVisible" class="mensaje-sesion-overlay">
    <div class="mensaje-sesion">
      <p>{{ mensajeTexto }}</p>
      <button class="boton-aceptar" (click)="cerrarMensaje()">Aceptar</button>
    </div>
  </div>

  <!-- Sección de eventos -->
  <div class="events-section">
    <ng-container *ngIf="isLoading; else eventListContent">
      <p class="loading-message">Cargando eventos...</p>
    </ng-container>

    <ng-template #eventListContent>
      <ng-container *ngIf="events.length > 0; else noEventsMessage">
        <div class="events-grid">
          <div *ngFor="let event of events" class="event-card">

            <!-- Imagen del evento (o bloque alternativo si no hay imagen) -->
            <ng-container *ngIf="event.imagen; else noImageBlock">
              <img [src]="event.imagen" alt="Imagen del evento" class="event-image">
            </ng-container>

            <ng-template #noImageBlock>
              <div class="terminal-mockup">
                <pre>
                  <span>▶</span> {{ event.titulo }}
                  <span>▶</span> {{ event.fecha | date:'yyyy-MM-dd' }}
                </pre>
              </div>
            </ng-template>

            <!-- Detalles del evento -->
            <div class="event-details">
              <h2>{{ event.titulo }}</h2>
              <p>{{ event.descripcion }}</p>
              <p style="display: flex; align-items: center; gap: 6px; color: rgb(83, 82, 82);">
                <svg xmlns="http://www.w3.org/2000/svg" height="18" width="18" viewBox="0 0 24 24" fill="#6c757d" aria-hidden="true">
                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5z"/>
                </svg>
                {{ event.ubicacion }}
               <p style="margin-top: 8px; font-weight: 600; text-align: center;">
                    {{ event.fecha | date:'dd/MM/yyyy' }}
                </p>

              <!-- Botones visibles solo para admin -->
              <div *ngIf="authService.isAdmin()" class="admin-controls">
                <button class="btn-editar" (click)="editarEvento(event)">Editar</button>
                <button class="btn-eliminar" (click)="eliminarEvento(event)">Eliminar</button>
              </div>

              <!-- Botones para todos -->
              <button class="buy-button" (click)="comprarTicket(event)">Comprar entrada</button>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Si no hay eventos -->
      <ng-template #noEventsMessage>
        <p class="error-message">{{ errorMessage || 'No hay eventos disponibles.' }}</p>
      </ng-template>
    </ng-template>

    <!-- Mensaje de error general -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>
  </div>

  <!-- Sección del formulario solo visible para ADMIN -->
  <div class="form-section" *ngIf="authService.isAdmin()" #formSection>
    <div class="form-card">
      <h2>{{ editingEventId ? 'Editar evento' : 'Crear nuevo evento' }}</h2>

      <div *ngIf="eventoForm.invalid && (eventoForm.dirty || eventoForm.touched)" class="form-error-message">
        Por favor, completa todos los campos requeridos.
      </div>

      <form [formGroup]="eventoForm" (ngSubmit)="submitEvento()">
        <div class="form-group">
          <label for="titulo">Título:</label>
          <input type="text" id="titulo" formControlName="titulo">
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción:</label>
          <textarea id="descripcion" formControlName="descripcion"></textarea>
        </div>

        <div class="form-group">
          <label for="ubicacion">Ubicación:</label>
          <input type="text" id="ubicacion" formControlName="ubicacion">
        </div>

        <div class="form-group fecha-input">
          <label for="fecha">Fecha:</label>
          <input type="date" id="fecha" formControlName="fecha">
        </div>

        <div class="form-group">
          <label for="imagen">Imagen:</label>
          <div class="file-upload">
            <input type="file" id="imagen" (change)="onFileChange($event)" #fileInput />
          </div>
        </div>

        <button type="submit" class="submit-button" [disabled]="eventoForm.invalid || (!selectedFile && !editingEventId)">
          {{ editingEventId ? 'Actualizar evento' : 'Guardar evento' }}
        </button>

        <button type="button" class="submit-button" *ngIf="editingEventId" (click)="resetForm()">
         Cancelar edición
        </button>
      </form>
    </div>
  </div>

</div>


